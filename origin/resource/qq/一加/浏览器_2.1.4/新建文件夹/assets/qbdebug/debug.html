<html>
<!--Harry Guo: 本网页是手机QQ浏览器调试项设置界面-->
<!--要增加调试项，1. 在form标签中增加一个子标签，配置好属性；2. 在script标签中增加一个方法，供修改设置时调用；3. 在浏览器中增加设置、获取设置项状态的接口，供js调用-->
	<head>
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.7"/>
		<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
		<title>调试开关</title>
			<style type="text/css">
				.tipsStyle {
					font-size: 9px;
					color: #FFFFFF;
					-webkit-border-radius:3px;
					background: -webkit-gradient(linear, 0 0, 0 100%, from(#bcbcbc), to(#5c5c5c));
				}
				body {
					background-color: #E7E8E8;
				}
				.borderRadius {
					-webkit-border-radius:10px;
					background: -webkit-gradient(linear, 0 0, 0 100%, from(#ffffff), to(#bcbcbc));
					border:1px solid #C9CACA
				}
			</style>
	</head>

	<!--页面加载完成后需要initStatus()，用来更新设置项状态-->
	<body onLoad="initStatus()" style="font-size:12px">

		<!--所有代码逻辑都是在这段js里面做的-->
		<script type="text/javascript">

			// 以下为各开关项的标签Id
			var x5ProxyElementId		= "x5Proxy";
			var serverAllowX5ProxyElementId	 = "serverAllowX5Proxy";
			var x5QHeadElementId		= "x5QHead";
			var useChromeNetId			= "useChromeNet";
			var webPSupportElementId	= "supportWebP";
			// var logCatLogElementId		= "logCatLog";
			var imageQualityName		= "ImageQuality";
			var packResourceId			= "packResource";
			var packResourceWifiId		= "packResourceWifi";
			//是否显示内存值
			var x5ShowMemValueId		= "showMemValue";
			var ipAddressId				= "ipAddress";
			var ipPortId				= "ipPort";
			//预链接
			var usePreConnection        = "usePreConn";
			//Flash相关
			var flashFullScreenId       = "flashFullScreen";
			//硬件加速
			var hardwareAcceleratedId   = "hardwareAccelerated";
			//代理请求加密
			var shouldEncryptedRequestElementId = "shouldEncryptedRequest";
			//首字首屏日志
			var logFirstTextAndFirstScreenId = "logFirstTextAndFirstScreen";
			
			var RenderTileId   = "renderTileId";
			var RenderTimeId   = "renderTimeId";
			var RenderMemoryId   = "renderMemoryId";
			
			function initStatus()					// 初始化设置项状态
			{
				// 通过js2java获取浏览器现存的设置项状态
				var x5ProxyEnabled		= window.tbsdebug.qbdebug().isX5ProxyEnabled();
				var serverAllowX5ProxyEnabled		= window.tbsdebug.qbdebug().isServerAllowX5ProxyEnabled();
				var x5QHeadEnabled		= window.tbsdebug.qbdebug().isX5QHeadEnabled();
				var ChromeNetEnabled	= window.tbsdebug.qbdebug().isUseChromeNet();
				var usePreConnEnabled	= window.tbsdebug.qbdebug().isX5PreConnEnabled();
				// var logCatLogEnabled	= window.tbsdebug.qbdebug().isLogCatLogEnabled();
				var webPSupportEnabled	= window.tbsdebug.qbdebug().isSupportWebP();
				var packResourceEnabled	= window.tbsdebug.qbdebug().getPackResource();
				var packResourceWifiEnabled	= window.tbsdebug.qbdebug().getPackResourceWifi();
				//是否显示内存值
				var x5ShowMemValueEnabled	= window.tbsdebug.qbdebug().getX5ShowMemValue();
				var supportReadModeEnabled  = window.tbsdebug.qbdebug().getSupportReadMode();
				var shouldEncryptedRequestEnabled = window.tbsdebug.qbdebug().getShouldEncryptedRequest();
				var logFirstTextAndFirstScreenEnabled = window.tbsdebug.qbdebug().getLogFirstTextAndFirstScreen();
				var imageQuality		= window.tbsdebug.qbdebug().getImageQuality();
				var ipAddress			= window.tbsdebug.qbdebug().getIPAddress();
				var ipPort				= window.tbsdebug.qbdebug().getIPPort();
				//Flash相关
				var flashFullScreenEnabled	= window.tbsdebug.qbdebug().isFlashFullScreen();
				//硬件加速
				var hardwareAccelerated = window.tbsdebug.qbdebug().getHardwareAccelerated();
				
				//渲染调试
				var rendertiledebug	= window.tbsdebug.qbdebug().getX5RenderTileDebug();	
				var renderperformdebug	= window.tbsdebug.qbdebug().getX5RenderMemoryDebug();
				var rendermemorydebug	= window.tbsdebug.qbdebug().getX5RenderPerformDebug();	
								
				// 初始化设置项状态
				document.getElementById(serverAllowX5ProxyElementId).checked = serverAllowX5ProxyEnabled;
				document.getElementById(x5ProxyElementId).checked		= x5ProxyEnabled;
				document.getElementById(x5QHeadElementId).checked		= x5QHeadEnabled;
				document.getElementById(useChromeNetId).checked			= ChromeNetEnabled;
				document.getElementById(usePreConnection).checked	    = usePreConnEnabled;
				// document.getElementById(logCatLogElementId).checked		= logCatLogEnabled;
				document.getElementById(webPSupportElementId).checked	= webPSupportEnabled;
				document.getElementById(packResourceId).checked			= packResourceEnabled;
				document.getElementById(packResourceWifiId).checked		= packResourceWifiEnabled;
				//是否显示内存值
				document.getElementById(x5ShowMemValueId).checked		= x5ShowMemValueEnabled;
				document.getElementById(shouldEncryptedRequestElementId).checked		= shouldEncryptedRequestEnabled;
				document.getElementById(logFirstTextAndFirstScreenId).checked		= logFirstTextAndFirstScreenEnabled;
				// 如果getElementsByName返回的数组不是7个，那代码就有bug
				if (imageQuality >= -1 && imageQuality <= 6)
					document.getElementsByName(imageQualityName)[imageQuality+1].checked = true;
				document.getElementById(ipAddressId).value				= ipAddress;
				document.getElementById(ipPortId).value					= ipPort;
				//Flash相关
				document.getElementById(flashFullScreenId).checked	    = flashFullScreenEnabled;
				//硬件加速
				if(hardwareAccelerated)
					document.getElementById(hardwareAcceleratedId).value = "当前使用硬件绘制";
					
				if(window.tbsdebug.qbdebug().isChromiumBuiltIn() == false)
					document.getElementById(useChromeNetId).disabled="true";
					

				document.getElementById(RenderTileId).checked	    = rendertiledebug;
				document.getElementById(RenderTimeId).checked	    = renderperformdebug;
				document.getElementById(RenderMemoryId).checked	    = rendermemorydebug;
			}

			function setX5Proxy(enable)				// 云加速开关
			{
				window.tbsdebug.qbdebug().setX5Proxy(enable);
				if (enable == true)					// 该项和以下项目相关联
				{
					setX5QHead(true);
					document.getElementById(x5QHeadElementId).checked = true;  	// 更新设置项标签
				}
				resultTips("云加速已"+(enable == true ? "开启":"关闭"), 1000);
			}

			function setServerAllowX5Proxy(enable)				// 强制开启云加速开关
			{
				window.tbsdebug.qbdebug().setServerAllowX5Proxy(enable);
				resultTips("强制开启云加速已"+(enable == true ? "开启":"关闭"), 1000);
			}

			function setX5QHead(enable)				// QUA/GUID/Q_AUTH
			{
				window.tbsdebug.qbdebug().setX5QHead(enable);
				if (enable == false)				// 该项和以下项目相关联
				{
					setX5Proxy(false);
					setPackResource(false);
					//setPackResourceWifi(false);
					document.getElementById(x5ProxyElementId).checked = false;  	// 更新设置项标签
					document.getElementById(packResourceId).checked = false;  		// 更新设置项标签
					document.getElementById(packResourceWifiId).checked = false;  	// 更新设置项标签
				}
				resultTips("QUA/GUID/Q_AUTH均已"+(enable == true ? "开启":"关闭"), 1000);
			}
			
			function setUseChromeNet(enable)
			{
				window.tbsdebug.qbdebug().setUseChromeNet(enable);
				resultTips("ChromeNet"+(enable == true ? "启用" : "关闭")+"，请重启浏览器", 1000);
			}
			
			function setX5PreConn(enable)			// 预连接
			{
				window.tbsdebug.qbdebug().setX5PreConn(enable);
				resultTips("预链接功能已"+(enable == true ? "启用":"禁用"), 1000);
			}

			function setWebPSupport(enable)			// webP开关
			{
				window.tbsdebug.qbdebug().setWebPSupport(enable);
				resultTips("webP支持已"+(enable == true ? "开启":"关闭"), 1000);
			}

			// function setLogCatLog(enable)			// LogCat日志开关
			// {
			// 	window.tbs.setLogCatLog(enable);
			// 	resultTips("LogCat日志已"+(enable == true ? "开启":"关闭"), 1000);
			// }

			function setPackResource(enable)		// 子资源打包(总开关)
			{
				window.tbsdebug.qbdebug().setPackResource(enable);
				if (enable == true)					// 该项和以下项目相关联
				{
					setX5Proxy(true);
					document.getElementById(x5ProxyElementId).checked = true;  	// 更新设置项标签
				}
				resultTips("子资源打包(总开关)已"+(enable == true ? "开启":"关闭"), 1000);
			}

			function setPackResourceWifi(enable)	// 子资源打包(Wifi)
			{
				window.tbsdebug.qbdebug().setPackResourceWifi(enable);
				if (enable == true)					// 该项和以下项目相关联
				{
					setX5Proxy(true);
					document.getElementById(x5ProxyElementId).checked = true;  	// 更新设置项标签
				}
				resultTips("子资源打包(Wifi)已"+(enable == true ? "开启":"关闭"), 1000);
			}

			function setX5ShowMemValue(enable)		// 是否显示内存值
			{
				window.tbsdebug.qbdebug().setX5ShowMemValue(enable);
				resultTips("显示内存值功能已"+(enable == true ? "开启":"关闭"), 1000);
			}
			
			function setSupportReadMode(enable)
			{
				window.tbsdebug.qbdebug().setSupportReadMode(enable);
				resultTips("阅读模式功能已"+(enable == true ? "开启":"关闭"), 1000);
			}
			
			function setShouldEncryptedRequest(enable)
			{
				window.tbsdebug.qbdebug().setShouldEncryptedRequest(enable);
				resultTips("代理下请求加密功能已"+(enable == true ? "开启":"关闭"), 1000);
			}
			
			function setLogFirstTextAndFirstScreen(enable)
			{
				window.tbsdebug.qbdebug().setLogFirstTextAndFirstScreen(enable);
				resultTips("首字首屏日志已"+(enable == true ? "开启":"关闭"), 1000);
			}

			function setImageQuality(quality)		// 图片质量设置
			{
				window.tbsdebug.qbdebug().setImageQuality(quality);
				resultTips("图片质量设置为 "+quality, 1000);
			}

			function confirmCustomSetting(nodeList)
			{
				var ipAddress;
				var ipPort;
				var i = 0;

				// 获取输入框中的值，赋给相应的参数。
				while (i < nodeList.childElementCount)
				{
					switch(nodeList.children[i].id)
					{
						default:
							break;
						case "ipAddress":
							ipAddress = nodeList.children[i].value;
							break;
						case "ipPort":
							ipPort = nodeList.children[i].value;
							break;
					}
					i++;
				}

				// 设置IP地址和端口号
				if (ipAddress == "" && ipPort == "")
				{
					window.tbsdebug.qbdebug().setProxyIPAddress("", "");
				}
				else if (ipAddress != "" && isIPAddress(ipAddress) && ipPort != "" && ipPort > -1 && ipPort < 65536)
				{
					window.tbsdebug.qbdebug().setProxyIPAddress(ipAddress, ipPort);
				}
				else
				{
					resultTips("请输入正确的IP地址或端口号", 1000);
					return;
				}

				resultTips("打包和代理设置成功~", 1000);
			}

			// 判断是否IP地址
			function isIPAddress(str)
			{
				if (str == null || str == "")
					return false;
				var pattern = new RegExp("^((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]|[*])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5]|[*])$");
				return str.match(pattern);
			}

			var tipsTimeoutId = 0;					// tips显示几秒后消失，需要定时器实现
			var opacityInterval = 0;				// 透明度渐隐的timer
			function resultTips(tips, delayTime)
			{
				var tipsElementId		= "resultTips";
				var tipsBackElementId	= "tipsBack";
				var styleOpacity = 1;
				document.getElementById(tipsBackElementId).style.display = "block";  // 显示提示标签
				if (tipsTimeoutId != 0)				// 以前也有该timeout，要取消它
				{
					clearTimeout(tipsTimeoutId);
					tipsTimeoutId = 0;
				}
				if (opacityInterval != 0)			// 渐隐的timer不能存在多个
				{
					clearInterval(opacityInterval);
					opacityInterval = 0;
				}
				document.getElementById(tipsElementId).innerHTML = "&nbsp;&nbsp;"+tips+"&nbsp;&nbsp;";	     // 弹出提示
				document.getElementById(tipsBackElementId).style.opacity = styleOpacity; // 设置可见度

				 // 定时消隐
				tipsTimeoutId = setTimeout(
					function()
					{
						tipsTimeoutId = 0;
						// 提示文字有渐隐的功能
						opacityInterval = setInterval(
							function()
							{
								styleOpacity -= 0.2;
								if (styleOpacity < 0)
								{	// 取消该interval
									clearInterval(opacityInterval);
									opacityInterval = 0;
									document.getElementById(tipsBackElementId).style.display = "none";
									return;
								}
								document.getElementById(tipsBackElementId).style.opacity = styleOpacity;
							}, 50); // 定时消隐
					}, delayTime);
			}
			
		    function setFlashFullScreen(enable)			// Flash强制全屏播放
			{
				window.tbsdebug.qbdebug().setFlashFullScreen(enable);
				resultTips("Flash强制全屏播放已"+(enable == true ? "开启":"关闭"), 1000);
			}

			function setShowVisualIndicator(show)
			{
				window.tbsdebug.qbdebug().setShowVisualIndicator(show);
				resultTips("硬件加速显示tile调试信息已"+ (show == true ? "开启":"关闭"),1000);
			}
			function setX5RenderTileDebug(enable)		// 是否显示渲染Tile
			{
				window.tbsdebug.qbdebug().setX5RenderTileDebug(enable);
				resultTips("渲染显示Tile功能已"+(enable == true ? "开启":"关闭"), 1000);
			}
			function setX5RenderMemoryDebug(enable)		// 是否显示渲染内存值
			{
				window.tbsdebug.qbdebug().setX5RenderMemoryDebug(enable);
				resultTips("渲染显示内存值功能已"+(enable == true ? "开启":"关闭"), 1000);
			}
			function setX5RenderPerformDebug(enable)		// 是否显示内存值
			{
				window.tbsdebug.qbdebug().setX5RenderPerformDebug(enable);
				resultTips("渲染耗时统计功能已"+(enable == true ? "开启":"关闭"), 1000);
			}
		</script>

		<!--这里是所有设置项-->
		<div>
			<table class="borderRadius"  bgcolor="#FFFFFF" width="170" cellspacing="0" bordercolor="#AAABA0" style="font-size:10px">
              <tr>
				<td>&nbsp;
				</td>
                <td>
					<br>
					<a href = "file:///android_asset/qbdebug/more.html"><U>&nbsp;&nbsp;扩展功能</U></a>
					<br>
					<input id="x5Proxy" alt="云加速" type="checkbox" name="云加速" onclick="setX5Proxy(this.checked)"/>云加速
					<br>
					<input id="serverAllowX5Proxy" alt="强制开启云加速" type="checkbox" name="强制开启云加速" onclick="setServerAllowX5Proxy(this.checked)"/>强制开启云加速
					<br>
					<br>
					<input id="x5QHead" alt="启用QUA/GUID/Q_AUTH" type="checkbox" name="启用QUA/GUID/Q_AUTH" onclick="setX5QHead(this.checked)"/>启用QUA/GUID/Q_AUTH
					<br>
					<input id="supportWebP" alt="webP支持" type="checkbox" name="webP支持" onclick="setWebPSupport(this.checked)"/>webP支持
					<br>
					<!--该项设置未被浏览器保存到本地，退出浏览器后将无效-->
					<input id="useChromeNet" alt="使用ChromeNet" type="checkbox" name="使用ChromeNet" onclick="setUseChromeNet(this.checked)" />使用ChromeNet
					<br>
					<input id="usePreConn" alt="使用预链接" type="checkbox" name="使用预链接"  onclick="setX5PreConn(this.checked)"/>使用预链接
					<br>
					<input id="packResource" alt="子资源打包(总开关)" type="checkbox" onclick="setPackResource(this.checked)"/>子资源打包(总开关)
					<br>
					<input id="packResourceWifi" alt="子资源打包(Wifi)" type="checkbox" onclick="setPackResourceWifi(this.checked)"/>子资源打包(Wifi)
					<br>
					<!--是否显示内存值-->
					<input id="showMemValue" alt="显示内存值" type="checkbox" onclick="setX5ShowMemValue(this.checked)"/>显示内存值
					<br>
					<input id="shouldEncryptedRequest" alt="加密请求" type="checkbox" onclick="setShouldEncryptedRequest(this.checked)"/>加密请求
					<br>
					<input id="logFirstTextAndFirstScreen" alt="首字首屏日志" type="checkbox" onclick="setLogFirstTextAndFirstScreen(this.checked)"/>首字首屏日志
					<br>
					<br>

					图片质量：
					<br>
					<form id="imageQualityForm">
						<input id="defaultId" type="radio" name="ImageQuality" value="default" onchange="setImageQuality(-1)"/>动态调整
						<br>
						<input id="noImageId" type="radio" name="ImageQuality" value="noImage" onchange="setImageQuality(0)"/>无图
						<br>
						<input id="scaleAdjustId" type="radio" name="ImageQuality" value="scaleAdjust" onchange="setImageQuality(1)"/>缩放且调整
						<br>
						<input id="lowQualityId" type="radio" name="ImageQuality" value="lowQuality" onchange="setImageQuality(2)"/>低质量
						<br>
						<input id="mediumId" type="radio" name="ImageQuality" value="medium" onchange="setImageQuality(3)"/>中等
						<br>
						<input id="highQualityId" type="radio" name="ImageQuality" value="highQuality" onchange="setImageQuality(4)"/>高质量
						<br>
						<input id="scaleNoAdjustId" type="radio" name="ImageQuality" value="scaleNoAdjust" onchange="setImageQuality(5)"/>缩放不调整
						<br>
						<input id="orignalImageId" type="radio" name="ImageQuality" value="orignalImage" onchange="setImageQuality(6)"/>原图
					</form>
					<br>
					渲染调试：
					<br>
					<form id="RenderForm">
						<input id="renderTileId" type="checkbox" alt="Tile显示" onchange="setX5RenderTileDebug(this.checked)"/>Tile显示
						<br>
						<input id="renderTimeId" type="checkbox" alt="绘制耗时监控" onchange="setX5RenderPerformDebug(this.checked)"/>绘制耗时监控
						<br>
						<input id="renderMemoryId" type="checkbox" alt="纹理内存日志" onchange="setX5RenderMemoryDebug(this.checked)"/>纹理内存日志					
					</form>
					<br>
				</td>
				<td>&nbsp;
				</td>
              </tr>
            </table>
			<br>

			<br>
			&nbsp;打包和IP地址设置：
			<br>
			<br>
			<table  class="borderRadius"  bgcolor="#FFFFFF" width="170" cellspacing="0" bordercolor="#AAABA0" style="font-size:10px">
				<tr>
				<td>&nbsp;
				</td>
                <td>
					<br>
					设IP地址
					<br>
					<input id="ipAddress" type="text" name="inputParam" value=""/>
					<br>
					<br>
					端口号
					<br>
					<input id="ipPort" type="text" name="inputParam" value=""/>
					<br>
					<br>
					<input type="button" value="确定" id="uploadLog" alt="确定" onclick="confirmCustomSetting(this.parentNode)"/>
					<br>
					<br>
				</td>
				<td>&nbsp;
				</td>
				</tr>
            </table>
            
            <br>
			&nbsp;Flash设置：
			<br>
			<table class="borderRadius"  bgcolor="#FFFFFF" width="170" cellspacing="0" bordercolor="#AAABA0" style="font-size:10px">
              <tr>
				<td>&nbsp;
				</td>
                <td>
					<br>
					<input id="flashFullScreen" alt="强制全屏" type="checkbox" name="强制全屏" onclick="setFlashFullScreen(this.checked)"/>强制全屏
					<br>
					
					<br>
				</td>
				<td>&nbsp;
				</td>
              </tr>
              <br>
            </table>
			<br>
<!--
			<table class="borderRadius"  bgcolor="#FFFFFF" width="170" cellspacing="0" style="font-size:10px">
              <tr class="borderRadius">&nbsp;
              </tr>
              <tr>
				<td>&nbsp;
				</td>
                
                <td>
					<input id="logCatLog" alt="LogCat调试日志" type="checkbox" name="LogCat调试日志" onclick="setLogCatLog(this.checked)"/>LogCat调试日志
					<br>
				</td>
			
				<td>&nbsp;
				</td>
              </tr>
            </table>
-->
		</div>

          <br>
			&nbsp;硬件加速：
			<br>
			<table class="borderRadius"  bgcolor="#FFFFFF" width="170" cellspacing="0" bordercolor="#AAABA0" style="font-size:10px">
              <tr>
				<td>&nbsp;
				</td>
                <td>
					<br>
					<input id="hardwareAccelerated" type="text" readonly="true" value="当前使用软件绘制"/>
					<br>
					
					<br>
				</td>
				<td>&nbsp;
				</td>
              </tr>
              <br>
            </table>

		<!--这里是给用户的tips提示（某开关已经开启/关闭）-->
		<div align="right" style="position:fixed; bottom:10px; color:Blue; font-size:8px">
			<table id="tipsBack" height="23" border="0" cellpadding="0" cellspacing="0" style="display:none">
				<tr>
				  <td width="9" background="left.png"></td>
				  <td background="middle.png"><p class="tipsStyle" id="resultTips" align="right"></p></td>
				  <td width="13" background="right.png"></td>
				</tr>
          </table>
		</div>

	</body>
</html>
