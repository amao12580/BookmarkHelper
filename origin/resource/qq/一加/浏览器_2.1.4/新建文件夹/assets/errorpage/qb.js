(function(){if(window.qb_bridge==undefined){var ua=navigator.userAgent.toLowerCase();if(ua.indexOf('mqqbrowser/5')!=-1){window.qb_bridge={nativeExec:function(service,action,callbackId,argsJson){return prompt(argsJson,'mtt:['+[service,action,callbackId]+']')}}}else{console.warn('Not a qq browser or version too old');return}}qb_bridge.callbackId=Math.floor(Math.random()*2000000000);qb_bridge.callbacks={};qb_bridge.exec=function(success,fail,service,action,args){var callbackId=service+qb_bridge.callbackId++,argsJson=args?JSON.stringify(args):"";if(success||fail){qb_bridge.callbacks[callbackId]={success:success,fail:fail}}var ret=qb_bridge.nativeExec(service,action,callbackId,argsJson);if(ret==='true'){return true}else if(ret==='false'){return false}else{return ret}};qb_bridge.callbackFromNative=function(callbackId,args){var callback=qb_bridge.callbacks[callbackId];var argsJson=JSON.parse(args);if(callback){if(argsJson.succ){callback.success&&callback.success(argsJson.msg)}else{callback.fail&&callback.fail(argsJson.msg)}if(!argsJson.keep){delete qb_bridge.callbacks[callbackId]}}};qb_bridge.createEvent=function(type,data){var event=document.createEvent('Events');event.initEvent(type,false,false);if(data){for(var i in data){if(data.hasOwnProperty(i)){event[i]=data[i]}}}return event}qb_bridge.fireEvent=function(type,params){var channel=qb_channel[type];if(channel){var data=params&&JSON.parse(params);var evt=qb_bridge.createEvent(type,data);channel.fire(evt)}}var QbChannel=function(type){this.type=type;this.handlers={};this.numHandlers=0;this.onHasSubscribersChange=null},qb_channel={create:function(type){return qb_channel[type]=new QbChannel(type)},nextGuid:0,};QbChannel.prototype.subscribe=function(f){var func=f,guid=f.observer_guid;if(!guid){guid=''+qb_channel.nextGuid++}func.observer_guid=guid;f.observer_guid=guid;if(!this.handlers[guid]){this.handlers[guid]=func;this.numHandlers++;if(this.numHandlers==1){this.onHasSubscribersChange&&this.onHasSubscribersChange()}}};QbChannel.prototype.unsubscribe=function(f){var guid=f.observer_guid,handler=this.handlers[guid];if(handler){delete this.handlers[guid];this.numHandlers--;if(this.numHandlers===0){this.onHasSubscribersChange&&this.onHasSubscribersChange()}}};QbChannel.prototype.fire=function(e){if(this.numHandlers){var toCall=[];for(var item in this.handlers){toCall.push(this.handlers[item])}for(var i=0;i<toCall.length;++i){toCall[i](e)}}};window.qb={screen:{addEventListener:function(type,handler,capture){if(type!=='onorientationchange'){return}var channel=qb_channel['onorientationchange'];if(!channel){channel=qb_channel.create('onorientationchange');channel.onHasSubscribersChange=function(){qb_bridge.exec(null,null,"screen","subscribeChanged",{numHandlers:this.numHandlers})}}channel.subscribe(handler)},removeEventListener:function(type,handler,capture){var channel=qb_channel[type];if(channel){channel.unsubscribe(handler)}},},}})();