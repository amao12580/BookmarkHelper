var showDetail=function(){var predef={dataConst:8,empty:{},errFunc:function(){G_helper.errorUploader('script','(使用native接口出错)');},nullFunc:function(){}};if(typeof nativePrivate==="undefined"){try{var nativePrivate={};nativePrivate.ua=navigator.userAgent;nativePrivate.isAndroid=(function(){return/android/ig.test(nativePrivate.ua);})();nativePrivate.isIos=(function(){return/iphone|ipod/ig.test(nativePrivate.ua);})();if(nativePrivate.isAndroid){try{nativePrivate.qua=JSON.parse(mtt.getBrowserParam());}catch(e){G_helper.errorUploader('script','(isAndroid出错)'+e.toString());}
nativePrivate.isx5=(function(){if(nativePrivate.qua.qua.indexOf('ADRQBX5')!=-1){return true;}else{return false;}})();}}catch(e){G_helper.errorUploader('script','(及预定义)'+e.toString());}}
_.templateSettings={evaluate:/\{%([\s\S]+?)%\}/g,interpolate:/\{%=([\s\S]+?)%\}/g,escape:/\{%-([\s\S]+?)%\}/g};var modTips=function(){window.location.reload();$('#modTips').css('display','none');};var processLoad=function(o,successback,errorback){try{var detailButton=$("#detailButton");var detailButtonBtndl=detailButton.find(".btn-dl");var detailButtonProgress=detailButton.find(".progress");detailButtonProgress.css('width','0%');detailButtonBtndl.removeClass('dload').addClass('dloading');skinState='dloading';var interval=setInterval(function(){nativeAPI.skinDlProgress({skinname:o.skinName,skinid:o.skinID},function(data){var proess=parseInt(data);if(proess<0){clearInterval(interval);if(skinState=='dloading'){skinState='dload';detailButtonBtndl.removeClass('dloading').addClass('dload');}
errorback&&errorback(proess);}else if(proess==100){clearInterval(interval);detailButtonProgress.css('width',proess*0.9+'%');successback&&successback();}else{detailButtonProgress.css('width',proess*0.9+'%');}},predef.errFunc)},200);}catch(e){G_helper.errorUploader('script','(处理皮肤数据封装出错)'+e.toString());}};var onSkinSwitch,onSkinUnzip;window.x5onSkinSwitch=function(skinID){if(!onSkinSwitch){return;}
onSkinSwitch(skinID);};window.x5onSkinUnzip=function(skinID){if(!onSkinUnzip){return;}
onSkinUnzip(skinID);};onSkinUnzip=function(skinID){try{if(skinID==skinRealID){G_helper.countUploader(4,skinId,oid);var detailButton=$("#detailButton");var detailButtonProgress=detailButton.find(".progress");detailButtonProgress.css('width',100+'%');}}catch(e){G_helper.errorUploader('script','(触发解压完成出错)'+e.toString());}};onSkinSwitch=function(skinID){try{if(skinID==skinRealID){G_helper.countUploader(6,skinId,oid);var detailButton=$("#detailButton");var detailButtonSpan=detailButton.find(".txt");detailButtonSpan.html("已使用");detailButton.find('.btn-dl').removeClass().addClass('btn-dl useing');skinState='useing';if(nativePrivate.isIos){nativeAPI.closeSkinCurPage(null,null);}}}catch(e){G_helper.errorUploader('script','(触发换肤出错)'+e.toString());}};function GetRequest(){var url=location.search;var theRequest=new Object();if(url.indexOf("?")!=-1){var str=url.substr(1);if(str.indexOf("&")!=-1){var strs=str.split("&");for(var i=0;i<strs.length;i++){theRequest[strs[i].split("=")[0]]=decodeURI(strs[i].split("=")[1]);}}else{theRequest[str.split("=")[0]]=decodeURI(str.split("=")[1]);}}
return theRequest;}
var slideImg=function(){try{var slideHei=document.querySelector('.mod-slide');var slideImg=document.querySelectorAll('.slide img');var resizePic=function(){var height=window.innerHeight-16-50;slideHei.style.height=height+'px';var imgH=height-18;var imgW=imgH*(360/639);var imgWidth=0;var imgHeight=0;if(imgW>window.innerWidth){imgWidth=window.innerWidth-16+'px';imgHeight=(window.innerWidth-16)*(639/360)+'px';}else{imgWidth=imgW+'px';imgHeight=imgH+'px';}
for(var i=0;i<slideImg.length;i++){slideImg[i].style.width=imgWidth;slideImg[i].style.height=imgHeight;}};resizePic();var slidePic=new MXD.app.slide().step('Core','#slides','.slide',{width:document.querySelector('#slides .slide li')}).step('TouchCore');window.addEventListener('resize',function(e){resizePic();slidePic.helper.refresh();});}catch(e){G_helper.errorUploader('script','(皮肤动画出错)');}};var ajax={};ajax.getSkinData=function(callback){try{var header={};if(nativePrivate.isAndroid&&nativePrivate.isx5===false){header={"Q-UA":nativePrivate.qua.qua,"Q-GUID":nativePrivate.qua.guid}}
var getDataUrl=location.protocol+'//'+location.host+"/skin/getSkinData";$.ajax({type:'GET',url:getDataUrl,data:{skinId:skinId},dataType:'json',headers:header,success:function(data){callback(1,data);},error:function(){callback(0);}});}catch(e){G_helper.errorUploader('script','(请求皮肤数据报错)'+e.toString());}};var loadData=function(callback){try{ajax.getSkinData(function(state,data){try{if(state==0||!data){return false;}
for(var i=0;i<data.detailImg.length;i++){if(data.skinType=='0'){data.detailImg[i].maskImg='#';}else if(data.skinType=='1'||data.skinType=='3'){data.detailImg[i].maskImg='http://3gimg.qq.com/mig-web/2014/QQbrowser/touch/native/skin_v2/img/bg_cover_mask.png';}else if(data.skinType=='2'||data.skinType=='4'){data.detailImg[i].maskImg='http://3gimg.qq.com/mig-web/2014/QQbrowser/touch/native/skin_v2/img/bg_cover_mask2.png';}}
try{nativeAPI.getAppVersion(function(dataVersion){if(dataVersion!='5.5'){data.detailImg.splice(1,data.detailImg.length);}},null);}catch(e){G_helper.errorUploader('script','(nativeAPI.getAppVersion出错)'+e.toString());}
callback(data);}catch(e){G_helper.errorUploader('script','(处理皮肤数据出错)'+e.toString());}});}catch(e){G_helper.errorUploader('script','(拉取皮肤数据封装出错)'+e.toString());}};var composeData=function(data,callback){try{var detailImg=$("#detailImg");var detailImgTmp=$("#detailImgTmp").html();var detailImgHtml=_.template(detailImgTmp,data);detailImg.html(detailImgHtml);slideImg();callback(data);}catch(e){G_helper.errorUploader('script','(skinDetail.html 数据结合出错)'+e.toString());}};var getSkinState=function(data){var dledSkins;var dlingSkins;var selectID;var detailButton=$("#detailButton");var detailButtonSpan=detailButton.find(".txt");var stateFlag=false;if(nativePrivate.isAndroid){data.skinID=data.skinName;skinRealID=data.skinID;}else{skinRealID=data.skinID;}
var useJson={};useJson.skinname=data.skinName;useJson.skinid=data.skinID;var setSkinState=function(){var detailButton=$("#detailButton");_.some(dledSkins,function(id){if(data.skinID==id){if(data.skinID==selectID){stateFlag=true;skinState='useing';detailButtonSpan.html("已使用");detailButton.find('.btn-dl').removeClass().addClass('btn-dl useing');}else{stateFlag=true;skinState='use';detailButtonSpan.html("应用");detailButton.find('.btn-dl').removeClass().addClass('btn-dl use');detailButton.unbind('click').click(function(){nativeAPI.useSkin(useJson,function(){skinState='useing';},predef.errFunc);});}
return true;}});_.some(dlingSkins,function(id){if(data.skinID==id){skinState='dloading';detailButtonSpan.html("下载");detailButton.find('.btn-dl').removeClass().addClass('btn-dl dloading');stateFlag=true;var load=new processLoad(data,function(){load=null;},function(){load=null;});return true;}});if(stateFlag==false){skinState='dload';detailButtonSpan.html("下载");detailButton.find('.btn-dl').removeClass().addClass('btn-dl dload');detailButton.unbind('click').click(function(){if(skinState=='useing'||skinState=='dloading'){return false;}
var json={};var filename=data.downUrl.substr(data.downUrl.lastIndexOf("/")+1,data.downUrl.length);json.url=data.downUrl;json.filename=filename;json.skinname=data.skinName;json.skinsize=data.skinSize;json.skindes=data.name;json.skinpicurl=data.picUrl;json.skinid=data.skinID;if(data.cardId!='-1'){json.cardid=data.cardId;json.cardname=data.cardName;}
try{G_helper.countUploader(5,skinId,oid);nativeAPI.downloadSkin(json,function(){var load=new processLoad(data,function(){load=null;},function(){load=null;})},predef.errFunc);}catch(e){G_helper.errorUploader('script','进入下载click失败'+e.toString());}});}};nativeAPI.dledSkinList(predef.empty,function(data){dledSkins=data.split('&');setSkinState();},predef.errFunc);nativeAPI.dlingSkinList(predef.empty,function(data){dlingSkins=data.split('&');setSkinState();},predef.errFunc);nativeAPI.useingSkinName(predef.empty,function(data){selectID=data;setSkinState();},predef.errFunc);};var request=GetRequest();var skinId=request['skinid'];var skinRealID="";var oid=request['oid'];var t=request['t'];var skinState;var initData=function(){if(t==undefined){G_helper.countUploader(3,skinId,oid);}else{G_helper.countUploader(t,skinId,oid);}
var globalLoading=$("#globalLoading");var slides=$("#slides");var detailButton=$("#detailButton");globalLoading.css("display","block");loadData(function(data){composeData(data,function(data){if(data.skinType=='0'){$('.mask').each(function(){$(this).remove();});}
$('.imgDetail').each(function(){$(this).on('load',function(){globalLoading.css("display","none");slides.css("display","block");detailButton.css("display","block");});});});getSkinState(data);});};initData();};showDetail();